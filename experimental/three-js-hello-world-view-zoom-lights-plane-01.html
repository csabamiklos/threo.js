<!DOCTYPE HTML>
<html>
<head>
<title>three.js - hello world - view - zoom - lights</title>
</head>
<body style="background:#ccc; margin:0; overflow:hidden;">
<div id="info" style="position: absolute; top: 0px; left: 30%; width: 100%; padding: 5px;">xxx</div>
<script src="http://mrdoob.github.com/three.js/build/Three.js"></script>
<script type="text/javascript" src="http://mrdoob.github.com/three.js/examples/js/Stats.js"></script>
<script>

  var mouseX = 0, mouseY = 0,
  lat = -12.5, lon = 0, phy = 0, theta = 0;
  
  var direction = new THREE.Vector3(),
  moveForward = false, moveBackward = false, rotate = false;
	
  moveUp = false, moveDown = false, moveLeft = false, moveRight = false;

  var windowHalfX = window.innerWidth / 2;
  var windowHalfY = window.innerHeight / 2;
	
  var scene = new THREE.Scene();
	
  var camera = new THREE.Camera( 60, window.innerWidth / window.innerHeight, 1, 200 );
  // camera.position.set(-5, 1, 2}; // << doesn't work / unable to move camera  << need to use .set()
  
  camera.position.x = -5;
  camera.position.y = 1;
  camera.position.z = 0;
  // camera.target.position = {x: 0, y: -0.5, z: -10};
	// camera.target.position.y = 0;
	
/*	
	var camera = new THREE.QuakeCamera( { fov: 50, aspect: window.innerWidth / window.innerHeight, near: 1, far: 10000, movementSpeed: 1, lookSpeed: 0.002, noFly: true, lookVertical: false } );
	camera.position.set( 0, 2, 0 );
*/
 	
	// Light added here
	var pointLight = new THREE.PointLight(0xffffff);
	scene.addLight(pointLight);		
	
	var plane = new THREE.Mesh(new Plane(10,10,50,50), new THREE.MeshBasicMaterial({ color: 0x666666, wireframe: true }))
	plane.position = {x: 0, y: -0.5, z: 0};
  plane.rotation = {x: 1.57, y: 0, z: 0};
  plane.scale = {x: 10, y: 10, z: 10};
  scene.addObject(plane);
  
	var cube = new THREE.Mesh(new Cube(1, 1, 1), new THREE.MeshPhongMaterial({color: Math.random() * 0xffffff, opacity: 0.8}));
	scene.addObject(cube);	
	
	var renderer = new THREE.WebGLRenderer();
	renderer.setSize(window.innerWidth, window.innerHeight);
	document.body.appendChild(renderer.domElement);
	
  var container, stats;
  
  container = document.createElement( 'div' );
	document.body.appendChild( container );
				
  stats = new Stats();
	stats.domElement.style.position = 'absolute';
	stats.domElement.style.top = '0px';
	stats.domElement.style.zIndex = 100;
	container.appendChild( stats.domElement );	

	document.addEventListener( 'mousedown', onDocumentMouseDown, false );
	document.addEventListener( 'mouseup', onDocumentMouseUp, false );
	document.addEventListener( 'mousemove', onDocumentMouseMove, false );
	document.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );
	
	function onDocumentMouseDown( event ) {
		event.preventDefault();
		event.stopPropagation();
		switch ( event.button ) {
			case 0: moveForward = true; break;
			case 1: rotate = true; break;
			case 2: moveBackward = true; break;
		}
	}

	function onDocumentMouseUp( event ) {
		event.preventDefault();
		event.stopPropagation();
		switch ( event.button ) {
			case 0: moveForward = false; rotate = false; break;
			case 1: rotate = false; break;
			case 2: moveBackward = false; rotate = false; break;
		}
	}

  function onDocumentMouseMove(event) {
	  mouseX = event.clientX - windowHalfX;
	  mouseY = event.clientY - windowHalfY;
  }

  document.addEventListener( 'DOMMouseScroll', onDocumentMouseWheel, false);
  var speed = 0.03;
  function onDocumentMouseWheel(event) {
		event.preventDefault();
		speed -= 0.0001 * event.detail;
		if (speed < 0.002 ) speed = 0.002;
	} 

	document.addEventListener( 'keydown', onDocumentKeyDown, false );
	document.addEventListener( 'keyup', onDocumentKeyUp, false );
	
  function onDocumentKeyDown( event ) {
    event.preventDefault();
		event.stopPropagation();
		switch( event.keyCode ) {
			case 38: /*up*/
			case 87: /*W*/ moveUp = true; break;

			case 37: /*left*/
			case 65: /*A*/ moveLeft = true; break;

			case 40: /*down*/
			case 83: /*S*/ moveDown = true; break;

			case 39: /*right*/
			case 68: /*D*/ moveRight = true; break;
			
			
		}
	};
	
	function goHome() {
	document.getElementById('info').innerHTML="got here: " + speed;
	camera.position.x = -5;
  camera.position.y = 5;
  camera.position.z = 0;
  
  camera.target.position.x = 0;
  camera.target.position.y = 0;
  camera.target.position.z = 0;
  
  pointLight.position = camera.position;

	renderer.render(scene, camera);
  }

	function onDocumentKeyUp( event ) {
    event.preventDefault();
		event.stopPropagation();
		switch( event.keyCode ) {
			case 38: /*up*/
			case 87: /*W*/ moveUp = false; break;

			case 37: /*left*/
			case 65: /*A*/ moveLeft = false; break;

			case 40: /*down*/
			case 83: /*S*/ moveDown = false; break;

			case 39: /*right*/
			case 68: /*D*/ moveRight = false; break;
			
			case 49: /* 1 */  goHome(); break;
		}
	};

	function loop() {
 		if ( moveForward ) camera.translateZ( - speed );
		if ( moveBackward ) camera.translateZ( speed );
		
		if ( moveUp   ) camera.translateY(0.1);
		if ( moveDown ) camera.translateY(-0.1);
		if ( moveLeft ) camera.translateX(-0.1);
		if ( moveRight) camera.translateX(0.1);

    if (moveForward || moveBackward) {
		  lon += mouseX * 0.002;
		  lat -= mouseY * 0.002;

		  lat = Math.max( - 85, Math.min( 85, lat ) );
		  phi = ( 90 - lat ) * 0.0174532925; // Math.PI / 180;
		  theta = lon * 0.0174532925; // Math.PI / 180;

		  camera.target.position.x = 100 * Math.sin( phi ) * Math.cos( theta ) + camera.position.x;
		  camera.target.position.y = 100 * Math.cos( phi ) + camera.position.y;
		  camera.target.position.z = 100 * Math.sin( phi ) * Math.sin( theta ) + camera.position.z;
		}
    		
		pointLight.position = camera.position;

		renderer.render(scene, camera);
		
		stats.update();
		document.getElementById('info').innerHTML="speed: " + speed;
	}

  setInterval(loop, 1000 / 60);

</script>
</body>
</html>